import 'dart:convert';

import 'package:flutter_test/flutter_test.dart';
import 'package:mockito/annotations.dart';
import 'package:mockito/mockito.dart';
import 'package:weather_mobile_engineer_test_1/models/forecast_model.dart';
import 'package:weather_mobile_engineer_test_1/repositories/forecast_repository.dart';

import 'forecast_test.mocks.dart';

@GenerateNiceMocks([MockSpec<ForecastRepository>()])
void main() {
  final data = Forecast();
  final mockRepository = MockForecastRepository();
  
  test("ForecastRepository returns a ForecastData type", () async {
    when(mockRepository.fetchForecastData(any, any))
      .thenAnswer((_) async => data);

    final response = await mockRepository.fetchForecastData(-23.5523, -46.6313);
    expect(response, isA<Forecast>());
    expect(response, data);
  });


  test("Forecast API returns a ForecastData type", () async {
    var apiResponse = Forecast.fromJson(jsonDecode(jsonResponse) as Map<String, dynamic>);
    
    when(mockRepository.fetchForecastData(any, any))
      .thenAnswer((_) async => apiResponse);

    final response = await mockRepository.fetchForecastData(-23.5523, -46.6313);
    expect(response.city!.name, 'Liberdade');
    expect(response.city!.country, 'BR');
  });
}


String jsonResponse = '''
{"cod":"200","message":0,"cnt":40,"list":[{"dt":1713117600,"main":{"temp":26.03,"feels_like":26.03,"temp_min":23.75,"temp_max":26.03,"pressure":1017,"sea_level":1017,"grnd_level":926,"humidity":59,"temp_kf":2.28},"weather":[{"id":500,"main":"Rain","description":"chuva leve","icon":"10d"}],"clouds":{"all":0},"wind":{"speed":2.57,"deg":269,"gust":2.73},"visibility":10000,"pop":0.2,"rain":{"3h":0.32},"sys":{"pod":"d"},"dt_txt":"2024-04-14 18:00:00"},{"dt":1713128400,"main":{"temp":24.84,"feels_like":25.1,"temp_min":22.45,"temp_max":24.84,"pressure":1016,"sea_level":1016,"grnd_level":927,"humidity":66,"temp_kf":2.39},"weather":[{"id":500,"main":"Rain","description":"chuva leve","icon":"10n"}],"clouds":{"all":33},"wind":{"speed":1.31,"deg":217,"gust":2.29},"visibility":10000,"pop":0.65,"rain":{"3h":0.68},"sys":{"pod":"n"},"dt_txt":"2024-04-14 21:00:00"},{"dt":1713139200,"main":{"temp":23.2,"feels_like":23.53,"temp_min":21.79,"temp_max":23.2,"pressure":1017,"sea_level":1017,"grnd_level":928,"humidity":75,"temp_kf":1.41},"weather":[{"id":500,"main":"Rain","description":"chuva leve","icon":"10n"}],"clouds":{"all":67},"wind":{"speed":0.41,"deg":129,"gust":1.03},"visibility":10000,"pop":0.63,"rain":{"3h":0.51},"sys":{"pod":"n"},"dt_txt":"2024-04-15 00:00:00"},{"dt":1713150000,"main":{"temp":21.07,"feels_like":21.58,"temp_min":21.07,"temp_max":21.07,"pressure":1017,"sea_level":1017,"grnd_level":928,"humidity":90,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"chuva leve","icon":"10n"}],"clouds":{"all":100},"wind":{"speed":1.02,"deg":82,"gust":2.08},"visibility":10000,"pop":1,"rain":{"3h":0.64},"sys":{"pod":"n"},"dt_txt":"2024-04-15 03:00:00"},{"dt":1713160800,"main":{"temp":20.35,"feels_like":20.87,"temp_min":20.35,"temp_max":20.35,"pressure":1015,"sea_level":1015,"grnd_level":927,"humidity":93,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"chuva leve","icon":"10n"}],"clouds":{"all":100},"wind":{"speed":1.72,"deg":65,"gust":3.72},"visibility":10000,"pop":1,"rain":{"3h":0.5},"sys":{"pod":"n"},"dt_txt":"2024-04-15 06:00:00"},{"dt":1713171600,"main":{"temp":19.87,"feels_like":20.37,"temp_min":19.87,"temp_max":19.87,"pressure":1016,"sea_level":1016,"grnd_level":927,"humidity":94,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"chuva leve","icon":"10n"}],"clouds":{"all":100},"wind":{"speed":2.39,"deg":56,"gust":5.05},"visibility":10000,"pop":0.96,"rain":{"3h":0.51},"sys":{"pod":"n"},"dt_txt":"2024-04-15 09:00:00"},{"dt":1713182400,"main":{"temp":19.69,"feels_like":20.17,"temp_min":19.69,"temp_max":19.69,"pressure":1018,"sea_level":1018,"grnd_level":929,"humidity":94,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"chuva leve","icon":"10d"}],"clouds":{"all":100},"wind":{"speed":2.54,"deg":40,"gust":5.79},"visibility":10000,"pop":1,"rain":{"3h":1.03},"sys":{"pod":"d"},"dt_txt":"2024-04-15 12:00:00"},{"dt":1713193200,"main":{"temp":20.2,"feels_like":20.6,"temp_min":20.2,"temp_max":20.2,"pressure":1018,"sea_level":1018,"grnd_level":928,"humidity":89,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"chuva leve","icon":"10d"}],"clouds":{"all":100},"wind":{"speed":2.13,"deg":58,"gust":4.39},"visibility":10000,"pop":0.45,"rain":{"3h":0.23},"sys":{"pod":"d"},"dt_txt":"2024-04-15 15:00:00"},{"dt":1713204000,"main":{"temp":20.21,"feels_like":20.61,"temp_min":20.21,"temp_max":20.21,"pressure":1016,"sea_level":1016,"grnd_level":927,"humidity":89,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"nublado","icon":"04d"}],"clouds":{"all":100},"wind":{"speed":2.31,"deg":56,"gust":3.91},"visibility":10000,"pop":0.06,"sys":{"pod":"d"},"dt_txt":"2024-04-15 18:00:00"},{"dt":1713214800,"main":{"temp":19.95,"feels_like":20.35,"temp_min":19.95,"temp_max":19.95,"pressure":1017,"sea_level":1017,"grnd_level":928,"humidity":90,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"nublado","icon":"04n"}],"clouds":{"all":99},"wind":{"speed":2.18,"deg":92,"gust":4.75},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-04-15 21:00:00"},{"dt":1713225600,"main":{"temp":19.68,"feels_like":20.03,"temp_min":19.68,"temp_max":19.68,"pressure":1018,"sea_level":1018,"grnd_level":929,"humidity":89,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"nublado","icon":"04n"}],"clouds":{"all":99},"wind":{"speed":2.31,"deg":90,"gust":6.43},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-04-16 00:00:00"},{"dt":1713236400,"main":{"temp":19.09,"feels_like":19.43,"temp_min":19.09,"temp_max":19.09,"pressure":1019,"sea_level":1019,"grnd_level":929,"humidity":91,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"nublado","icon":"04n"}],"clouds":{"all":96},"wind":{"speed":2.15,"deg":60,"gust":5.91},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-04-16 03:00:00"},{"dt":1713247200,"main":{"temp":18.85,"feels_like":19.11,"temp_min":18.85,"temp_max":18.85,"pressure":1017,"sea_level":1017,"grnd_level":928,"humidity":89,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"nublado","icon":"04n"}],"clouds":{"all":95},"wind":{"speed":1.68,"deg":51,"gust":3.93},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-04-16 06:00:00"},{"dt":1713258000,"main":{"temp":18.99,"feels_like":19.22,"temp_min":18.99,"temp_max":18.99,"pressure":1018,"sea_level":1018,"grnd_level":928,"humidity":87,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"nublado","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":1.73,"deg":37,"gust":2.9},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-04-16 09:00:00"},{"dt":1713268800,"main":{"temp":21.17,"feels_like":21.38,"temp_min":21.17,"temp_max":21.17,"pressure":1019,"sea_level":1019,"grnd_level":930,"humidity":78,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"nublado","icon":"04d"}],"clouds":{"all":99},"wind":{"speed":2.15,"deg":23,"gust":4.15},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-04-16 12:00:00"},{"dt":1713279600,"main":{"temp":28.02,"feels_like":28.47,"temp_min":28.02,"temp_max":28.02,"pressure":1016,"sea_level":1016,"grnd_level":928,"humidity":50,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"nuvens dispersas","icon":"03d"}],"clouds":{"all":28},"wind":{"speed":3.15,"deg":360,"gust":3.97},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-04-16 15:00:00"},{"dt":1713290400,"main":{"temp":26.83,"feels_like":27.74,"temp_min":26.83,"temp_max":26.83,"pressure":1014,"sea_level":1014,"grnd_level":926,"humidity":58,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"chuva leve","icon":"10d"}],"clouds":{"all":59},"wind":{"speed":3.99,"deg":330,"gust":5.11},"visibility":10000,"pop":1,"rain":{"3h":0.96},"sys":{"pod":"d"},"dt_txt":"2024-04-16 18:00:00"},{"dt":1713301200,"main":{"temp":24.3,"feels_like":24.72,"temp_min":24.3,"temp_max":24.3,"pressure":1015,"sea_level":1015,"grnd_level":927,"humidity":74,"temp_kf":0},"weather":[{"id":501,"main":"Rain","description":"chuva moderada","icon":"10n"}],"clouds":{"all":100},"wind":{"speed":2.89,"deg":338,"gust":6.53},"visibility":10000,"pop":1,"rain":{"3h":3.26},"sys":{"pod":"n"},"dt_txt":"2024-04-16 21:00:00"},{"dt":1713312000,"main":{"temp":23.01,"feels_like":23.4,"temp_min":23.01,"temp_max":23.01,"pressure":1016,"sea_level":1016,"grnd_level":928,"humidity":78,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"chuva leve","icon":"10n"}],"clouds":{"all":100},"wind":{"speed":1.94,"deg":7,"gust":3.71},"visibility":10000,"pop":1,"rain":{"3h":0.85},"sys":{"pod":"n"},"dt_txt":"2024-04-17 00:00:00"},{"dt":1713322800,"main":{"temp":22.52,"feels_like":22.89,"temp_min":22.52,"temp_max":22.52,"pressure":1016,"sea_level":1016,"grnd_level":927,"humidity":79,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"nublado","icon":"04n"}],"clouds":{"all":98},"wind":{"speed":0.48,"deg":331,"gust":0.96},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-04-17 03:00:00"},{"dt":1713333600,"main":{"temp":21.93,"feels_like":22.29,"temp_min":21.93,"temp_max":21.93,"pressure":1015,"sea_level":1015,"grnd_level":926,"humidity":81,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"nublado","icon":"04n"}],"clouds":{"all":98},"wind":{"speed":1.16,"deg":347,"gust":1.19},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-04-17 06:00:00"},{"dt":1713344400,"main":{"temp":21.09,"feels_like":21.55,"temp_min":21.09,"temp_max":21.09,"pressure":1016,"sea_level":1016,"grnd_level":927,"humidity":88,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"chuva leve","icon":"10n"}],"clouds":{"all":100},"wind":{"speed":1.29,"deg":313,"gust":1.5},"visibility":10000,"pop":0.9,"rain":{"3h":0.72},"sys":{"pod":"n"},"dt_txt":"2024-04-17 09:00:00"},{"dt":1713355200,"main":{"temp":22.46,"feels_like":22.88,"temp_min":22.46,"temp_max":22.46,"pressure":1017,"sea_level":1017,"grnd_level":929,"humidity":81,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"nublado","icon":"04d"}],"clouds":{"all":99},"wind":{"speed":2.09,"deg":293,"gust":3.3},"visibility":10000,"pop":0.58,"sys":{"pod":"d"},"dt_txt":"2024-04-17 12:00:00"},{"dt":1713366000,"main":{"temp":26.44,"feels_like":26.44,"temp_min":26.44,"temp_max":26.44,"pressure":1015,"sea_level":1015,"grnd_level":927,"humidity":61,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"chuva leve","icon":"10d"}],"clouds":{"all":86},"wind":{"speed":2.87,"deg":265,"gust":4.16},"visibility":10000,"pop":1,"rain":{"3h":0.63},"sys":{"pod":"d"},"dt_txt":"2024-04-17 15:00:00"},{"dt":1713376800,"main":{"temp":25.21,"feels_like":25.64,"temp_min":25.21,"temp_max":25.21,"pressure":1014,"sea_level":1014,"grnd_level":925,"humidity":71,"temp_kf":0},"weather":[{"id":501,"main":"Rain","description":"chuva moderada","icon":"10d"}],"clouds":{"all":94},"wind":{"speed":3.29,"deg":230,"gust":4.29},"visibility":9503,"pop":1,"rain":{"3h":4.38},"sys":{"pod":"d"},"dt_txt":"2024-04-17 18:00:00"},{"dt":1713387600,"main":{"temp":21.09,"feels_like":21.71,"temp_min":21.09,"temp_max":21.09,"pressure":1016,"sea_level":1016,"grnd_level":927,"humidity":94,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"chuva leve","icon":"10n"}],"clouds":{"all":100},"wind":{"speed":4.6,"deg":164,"gust":8.34},"visibility":2998,"pop":1,"rain":{"3h":2.84},"sys":{"pod":"n"},"dt_txt":"2024-04-17 21:00:00"},{"dt":1713398400,"main":{"temp":20.32,"feels_like":20.89,"temp_min":20.32,"temp_max":20.32,"pressure":1018,"sea_level":1018,"grnd_level":928,"humidity":95,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"chuva leve","icon":"10n"}],"clouds":{"all":100},"wind":{"speed":4.48,"deg":157,"gust":8.21},"visibility":10000,"pop":1,"rain":{"3h":0.81},"sys":{"pod":"n"},"dt_txt":"2024-04-18 00:00:00"},{"dt":1713409200,"main":{"temp":18.91,"feels_like":19.34,"temp_min":18.91,"temp_max":18.91,"pressure":1018,"sea_level":1018,"grnd_level":929,"humidity":95,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"chuva leve","icon":"10n"}],"clouds":{"all":100},"wind":{"speed":4.56,"deg":153,"gust":8.16},"visibility":10000,"pop":1,"rain":{"3h":0.49},"sys":{"pod":"n"},"dt_txt":"2024-04-18 03:00:00"},{"dt":1713420000,"main":{"temp":17.9,"feels_like":18.15,"temp_min":17.9,"temp_max":17.9,"pressure":1017,"sea_level":1017,"grnd_level":928,"humidity":92,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"chuva leve","icon":"10n"}],"clouds":{"all":100},"wind":{"speed":4.42,"deg":151,"gust":8.05},"visibility":10000,"pop":0.65,"rain":{"3h":0.22},"sys":{"pod":"n"},"dt_txt":"2024-04-18 06:00:00"},{"dt":1713430800,"main":{"temp":16.92,"feels_like":17.04,"temp_min":16.92,"temp_max":16.92,"pressure":1019,"sea_level":1019,"grnd_level":929,"humidity":91,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"chuva leve","icon":"10n"}],"clouds":{"all":100},"wind":{"speed":4.37,"deg":145,"gust":7.88},"visibility":10000,"pop":0.24,"rain":{"3h":0.11},"sys":{"pod":"n"},"dt_txt":"2024-04-18 09:00:00"},{"dt":1713441600,"main":{"temp":17.29,"feels_like":17.22,"temp_min":17.29,"temp_max":17.29,"pressure":1020,"sea_level":1020,"grnd_level":930,"humidity":82,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"nublado","icon":"04d"}],"clouds":{"all":100},"wind":{"speed":4.94,"deg":142,"gust":6.59},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-04-18 12:00:00"},{"dt":1713452400,"main":{"temp":19.34,"feels_like":19.18,"temp_min":19.34,"temp_max":19.34,"pressure":1019,"sea_level":1019,"grnd_level":929,"humidity":71,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"nublado","icon":"04d"}],"clouds":{"all":100},"wind":{"speed":3.88,"deg":135,"gust":4.3},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-04-18 15:00:00"},{"dt":1713463200,"main":{"temp":20.49,"feels_like":20.32,"temp_min":20.49,"temp_max":20.49,"pressure":1017,"sea_level":1017,"grnd_level":928,"humidity":66,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"nublado","icon":"04d"}],"clouds":{"all":96},"wind":{"speed":4.09,"deg":141,"gust":4.1},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-04-18 18:00:00"},{"dt":1713474000,"main":{"temp":18.3,"feels_like":18.04,"temp_min":18.3,"temp_max":18.3,"pressure":1018,"sea_level":1018,"grnd_level":928,"humidity":71,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"nublado","icon":"04n"}],"clouds":{"all":98},"wind":{"speed":4.47,"deg":135,"gust":5.01},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-04-18 21:00:00"},{"dt":1713484800,"main":{"temp":16.39,"feels_like":16.17,"temp_min":16.39,"temp_max":16.39,"pressure":1019,"sea_level":1019,"grnd_level":929,"humidity":80,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"nublado","icon":"04n"}],"clouds":{"all":54},"wind":{"speed":3.51,"deg":125,"gust":6.17},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-04-19 00:00:00"},{"dt":1713495600,"main":{"temp":15.54,"feels_like":15.34,"temp_min":15.54,"temp_max":15.54,"pressure":1019,"sea_level":1019,"grnd_level":929,"humidity":84,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"céu limpo","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":2.96,"deg":118,"gust":6.77},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-04-19 03:00:00"},{"dt":1713506400,"main":{"temp":14.78,"feels_like":14.56,"temp_min":14.78,"temp_max":14.78,"pressure":1018,"sea_level":1018,"grnd_level":928,"humidity":86,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"céu limpo","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":2.19,"deg":112,"gust":6.04},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-04-19 06:00:00"},{"dt":1713517200,"main":{"temp":14.08,"feels_like":13.66,"temp_min":14.08,"temp_max":14.08,"pressure":1018,"sea_level":1018,"grnd_level":928,"humidity":81,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"céu limpo","icon":"01n"}],"clouds":{"all":2},"wind":{"speed":1.97,"deg":95,"gust":5.23},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-04-19 09:00:00"},{"dt":1713528000,"main":{"temp":17.23,"feels_like":16.68,"temp_min":17.23,"temp_max":17.23,"pressure":1019,"sea_level":1019,"grnd_level":929,"humidity":64,"temp_kf":0},"weather":[{"id":801,"main":"Clouds","description":"algumas nuvens","icon":"02d"}],"clouds":{"all":24},"wind":{"speed":3.45,"deg":99,"gust":5.39},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-04-19 12:00:00"},{"dt":1713538800,"main":{"temp":22.56,"feels_like":21.92,"temp_min":22.56,"temp_max":22.56,"pressure":1018,"sea_level":1018,"grnd_level":929,"humidity":40,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"nuvens dispersas","icon":"03d"}],"clouds":{"all":35},"wind":{"speed":3.18,"deg":108,"gust":3.51},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-04-19 15:00:00"}],"city":{"id":3458611,"name":"Liberdade","coord":{"lat":-23.55,"lon":-46.63},"country":"BR","population":0,"timezone":-10800,"sunrise":1713086382,"sunset":1713127993}}
''';